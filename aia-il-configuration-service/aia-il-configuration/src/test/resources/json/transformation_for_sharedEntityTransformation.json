{
  "modelType": "TRANSFORMATION",
  "projectKey": "aia",
  "displayName": null,
  "storeName": "aLDMCustomerDataChannel-Customer-CustomerContext",
  "description": "",
  "status": "DRAFT",
  "originProcess": "MAPPING_SHEETS_MIGRATION",
  "createdBy": null,
  "createdAt": null,
  "contextKey": "CustomerContext",
  "customScript": "select\r\n  CUST.CUSTOMER_ID as customerKey,\r\n  BC.DFLT_PRE_PCN as defaultPostpaidPayChannelKey,\r\n  BC.DFLT_POST_PCN as defaultPrepaidPayChannelKey,\r\n  TCR.CON_BUS_ROLE2CONTACT as mainContactKey,\r\n  NULL as parentCustomerKey,\r\n  CUST.NAME as customerLegalName,\r\n  NULL as salesChannelKey, -- Denormalize Sales Channel Key from the 1st Subscriber of the Customer.\r\n  BC.CUST_SUB_TYPE  as customerSubTypeKey,\r\n  NULL as customerStatusKey,\r\n  CASE \r\n    WHEN TCR.ADDR_SRC_TYPE = 47 THEN 'A'||TCR.ADDR_SRC_LOWID \r\n    WHEN TCR.ADDR_SRC_TYPE = 427 THEN 'E'||TCR.ADDR_SRC_LOWID\r\n  END as mainAddressKey,\r\n  BC.CREDIT_CLASS as creditClassKey,\r\n  BC.OPEN_DATE as openDate,\r\n  CUST.ACQUISITION_DATE as acquisitionDate,\r\n  CASE BC.LARGE_CUST_IND\r\n    WHEN 'Y' THEN '1'\r\n    ELSE '0'\r\n  END as largeCustomerFlag,\r\n  BC.BILL_CYC_PROD_FREQ as billCycleFrequencyInd,\r\n  BC.BILL_CYCLE as billingCycleKey,\r\n\tGR.countryKey as countryKey,  -- ADH has REF_ID\r\n  TA.ADDRESS as streetAddress,\r\n  TA.STREET_NAME as postalStreetName,\r\n  NULL as cityKey, -- aLDM City entity has to be constructed on the fly from Address\r\n  TA.ZIPCODE as zipCode,\r\n  NULL as acquisitionCampaignKey, -- Customized\r\n\tGR.stateKey as stateKey,  -- ADH has REF_ID\r\n  NULL as mvnoFlag, -- Customized\r\n  CASE WHEN TBO.OBJID is not null THEN TBO.PHONE \r\n       WHEN TCO.OBJID is not null THEN TCO.PHONE\r\n  END as phoneNumber,\r\n  TBO.SALES_RATING as salesRating,\r\n  TBO.STRUCT_TYPE as structureTypeInd,\r\n  NULL as serviceProviderKey, -- Customized\r\n  TBO.WEB_SITE as webSite,\r\n  CASE WHEN TBO.OBJID is not null THEN TBO.E_MAIL\r\n       WHEN TCO.OBJID is not null THEN TCO.E_MAIL\r\n  END as email,\r\n  cast(TBO.OBJID as text) as crmBusinessOrganizationSourceId,\r\n  cast(CUST.OBJID as text) as crmCustomerSourceId,\r\n  CUST.CUSTOMER_ID as cmCustomerSourceId,\r\n  TCR.CON_BUS_ROLE2CONTACT as crmCustomerMainContactSourceId,\r\n  NULL as sourceSystemId, -- N/A\r\n  TBO.FISCAL_YEAR_END as fiscalYearEndDate,\r\n  TBO.BUSINESS_DESC as businessPurposeDesc,\r\n  TBO.SIZE_EMPL as employeesNumber,\r\n  TBO.REVN_RANGE as revenueRange,\r\n  TBO.STOCK_SYM as stockCode,\r\n  NULL as corporationCode, -- Customized\r\n  NULL as corporationName, -- Customized\r\n  NULL as dealerKey, -- Denormalize Dealer Key from the 1st subscriber of the customer\r\n  BC.CUSTOMER_TYPE as customerTypeKey,\r\n  BC.CHG_CYC_REQ_DATE as changeCycleRequestDate,\r\n  BC.CHG_CYCLE_REQ_STS as changeCycleRequestStatusInd,\r\n  BC.CHG_CYCLE_IND as changeCycleRequestFlag,\r\n  BC.EXTERNAL_ID as externalId,\r\n  BC.SYS_CREATION_DATE as bssCreationDate,\r\n  BC.SYS_UPDATE_DATE as bssModificationDate,\r\n  BC.OPERATOR_ID as modificationEmployeeKey,\r\n  BC.LAST_ACTIVITY_REASON_CODE as lastActivityReasonKey,\r\n  NULL as lineOfBusinessKey, -- Customized: Get all Product Line of Business from Subscriber where Subscriber.Customer Key = Customer.Customer Key and concatenate Product Line of Business Id with '+'. Lookup in Line of Business to get the Line of Business Key.\r\n  BC.NEW_CYC_PROD_FREQ as requestedBillCycleFrequencyInd,\r\n  BC.NEW_CYCLE as requestedBillingCycleKey\r\n\r\nfrom table_customer CUST\r\nleft outer join MTM_BUS_ORG95_CUSTOMER1 MBO\r\non CUST.OBJID = MBO.CUSTOMER2BUS_ORG\r\nleft outer join TABLE_BUS_ORG TBO\r\non MBO.BUS_ORG2CUSTOMER = TBO.OBJID\r\nleft outer join MTM_CONTACT56_CUSTOMER0 MCC\r\non CUST.OBJID = MCC.CUSTOMER2CONTACT\r\nleft outer join TABLE_CONTACT TCO\r\non MCC.CONTACT2CUSTOMER = TCO.OBJID\r\nleft outer join CUSTOMER BC\r\non CUST.CUSTOMER_ID = BC.CUSTOMER_ID\r\nleft outer join TABLE_CON_BUS_ROLE TCR\r\non CUST.OBJID = TCR.CON_BUS_ROLE2CUSTOMER and TCR.ACTIVE = 1 and TCR.ROLE_NAME = 'Primary'\r\nleft outer join TABLE_ADDRESS TA\r\non TCR.ADDR_SRC_TYPE = 47 and TCR.ADDR_SRC_LOWID = TA.OBJID\r\nleft outer join GEONAME_REF GR\r\non GR.stateId = TA.ADDRESS2STATE_PROV\r\n\r\n",
  "customScriptForDeletionKeys": null,
  "customGroovyScript": null,
  "customGroovyScriptForDeletionKeys": null,
  "elementType": null,
  "elementVersion": null,
  "id": "aLDMCustomerDataChannel-Customer-CustomerContext",
  "implementationType": "CUSTOM_SQL",
  "lastUpdateTime": null,
  "origin": null,
  "ownerProjectKey": null,
  "productKey": null,
  "properties": null,
  "propertyValues": null,
  "referenceIds": null,
  "referenceSourceEntities": [],
  "sourceElementId": null,
  "sourceType": "CONTEXT",
  "tags": null,
  "targetEntityStoreKey": "Customer",
  "targetSchemaStoreKey": "aLDMCustomerDataChannel",
  "targetSchemaName": "aLDMCustomer",
  "isPublished": false,
  "referenceAttributes": []
}